<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Optimización de Carteras - Maximización del Sharpe Ratio</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @page {
            size: A4;
            margin: 1.2cm;
        }

        body {
            font-family: 'Arial', 'Helvetica', sans-serif;
            font-size: 8.5pt;
            line-height: 1.2;
            color: #2c3e50;
            background: white;
            padding: 0;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 1.2cm;
        }

        h1 {
            font-size: 13pt;
            color: #1a5490;
            margin-bottom: 0.25cm;
            border-bottom: 2.5px solid #1a5490;
            padding-bottom: 0.1cm;
            text-align: center;
        }

        h2 {
            font-size: 10pt;
            color: #2c5aa0;
            margin-top: 0.3cm;
            margin-bottom: 0.15cm;
            border-left: 3px solid #2c5aa0;
            padding-left: 0.2cm;
        }

        h3 {
            font-size: 9pt;
            color: #3d6ba8;
            margin-top: 0.2cm;
            margin-bottom: 0.1cm;
            font-weight: bold;
        }

        p {
            margin-bottom: 0.15cm;
            text-align: justify;
        }

        .section {
            margin-bottom: 0.25cm;
        }

        .metrics-table {
            width: 100%;
            border-collapse: collapse;
            margin: 0.2cm 0;
            font-size: 7.5pt;
        }

        .metrics-table th,
        .metrics-table td {
            border: 1px solid #b0c4de;
            padding: 0.08cm;
            text-align: center;
        }

        .metrics-table th {
            background-color: #1a5490;
            color: white;
            font-weight: bold;
        }

        .metrics-table tr:nth-child(even) {
            background-color: #f0f5ff;
        }

        .metrics-table tr:nth-child(odd) {
            background-color: white;
        }

        .highlight {
            background-color: #e8f4f8;
            padding: 0.08cm;
            border-left: 2px solid #1a5490;
            margin: 0.15cm 0;
            font-size: 8pt;
        }

        .formula {
            font-family: 'Times New Roman', serif;
            font-style: italic;
            text-align: center;
            margin: 0.1cm 0;
            padding: 0.08cm;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            font-size: 8.5pt;
        }

        .layer-box {
            border: 1px solid #b0c4de;
            padding: 0.15cm;
            margin: 0.15cm 0;
            background-color: #f8faff;
            border-left: 3px solid #2c5aa0;
        }

        .layer-box h3 {
            margin-top: 0;
            color: #1a5490;
        }

        .layer-box p {
            margin-bottom: 0.1cm;
        }

        .results-box {
            background-color: #e8f4f8;
            border: 2px solid #1a5490;
            padding: 0.2cm;
            margin: 0.2cm 0;
            border-radius: 2px;
        }

        .footer {
            margin-top: 0.3cm;
            font-size: 6.5pt;
            color: #666;
            text-align: center;
            border-top: 1px solid #ddd;
            padding-top: 0.15cm;
        }

        .figure {
            margin: 0.15cm 0;
            text-align: center;
            page-break-inside: avoid;
        }

        .figure img {
            max-width: 100%;
            height: auto;
            border: 1px solid #ccc;
            max-height: 3.5cm;
            object-fit: contain;
        }

        .figure-caption {
            font-size: 6.5pt;
            color: #555;
            margin-top: 0.05cm;
            font-style: italic;
        }

        .two-column {
            display: flex;
            gap: 0.2cm;
            margin: 0.15cm 0;
        }

        .two-column > div {
            flex: 1;
        }

        @media print {
            body {
                margin: 0;
                padding: 0;
            }

            .container {
                padding: 1.2cm;
            }

            .page-break {
                page-break-before: always;
            }

            .no-break {
                page-break-inside: avoid;
            }

            h1, h2 {
                page-break-after: avoid;
            }

            .figure {
                page-break-inside: avoid;
            }
        }

        ul {
            margin-left: 0.6cm;
            margin-bottom: 0.15cm;
        }

        li {
            margin-bottom: 0.05cm;
            font-size: 8pt;
        }

        .intro-text {
            font-size: 8pt;
            line-height: 1.2;
        }

        .winner-highlight {
            background-color: #d4edda !important;
            font-weight: bold;
        }

        .compact-list {
            margin: 0.1cm 0;
        }

        .compact-list li {
            margin-bottom: 0.03cm;
        }

        .mini-section {
            margin-bottom: 0.15cm;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>OPTIMIZACIÓN DE CARTERAS: MAXIMIZACIÓN DEL SHARPE RATIO</h1>
        
        <div class="mini-section">
            <h2>1. INTRODUCCIÓN</h2>
            <p class="intro-text">
                <strong>Objetivo:</strong> Maximizar el Sharpe Ratio anualizado mediante optimización de carteras aplicando teoría moderna de portafolios (Markowitz) con enfoque modular e iterativo. <strong>Universo:</strong> 50 activos, 1,760 días (~7 años). <strong>Restricciones:</strong> Long-only, Σw = 1, renta fija ≤ 10%, r<sub>f</sub> = 2% anual.
            </p>
        </div>

        <div class="section">
            <h2>2. METODOLOGÍA - EVOLUCIÓN POR CAPAS</h2>

            <div class="layer-box no-break">
                <h3>Capa 1: Baseline - Cartera Equiponderada</h3>
                <p>Asignación uniforme 1/N (2% por activo) sobre 50 activos. <strong>Resultado:</strong> Sharpe = 0.103, Rentabilidad = 3.25%, Volatilidad = 12.06%.</p>
            </div>

            <div class="layer-box no-break">
                <h3>Capa 2: Optimización de Markowitz sobre 50 Activos</h3>
                <p>Maximización del Sharpe mediante optimización cuadrática: max (w'μ - r<sub>f</sub>) / √(w'Σw). <strong>Problema:</strong> Alta concentración y correlaciones limitan diversificación. <strong>Resultado:</strong> Sharpe = 0.042, Rentabilidad = 2.40%, Volatilidad = 9.42%.</p>
                <div class="figure no-break">
                    <img src="notebooks_demostracion/outputs/modulo2_frontera.png" alt="Frontera Eficiente">
                    <div class="figure-caption">Fig. 1: Frontera eficiente de Markowitz (50 activos)</div>
                </div>
            </div>

            <div class="layer-box no-break">
                <h3>Capa 3: Análisis de Diversificación</h3>
                <p>Descomposición del riesgo: σ²<sub>p</sub> = (1/n)V̄ + (1-1/n)Cov̄<sub>ij</sub>. Simulación Monte Carlo (100 iter./N). <strong>N óptimo:</strong> 6 activos (reducción marginal de volatilidad < 2%).</p>
                <div class="figure no-break">
                    <img src="notebooks_demostracion/outputs/modulo2_diversificacion.png" alt="Diversificación">
                    <div class="figure-caption">Fig. 2: Frontera de diversificación - Volatilidad vs N activos</div>
                </div>
            </div>

            <div class="layer-box no-break">
                <h3>Capa 4: Selección Inteligente de Activos</h3>
                <p>Criterios duales: Score = 0.7 × Sharpe<sub>norm</sub> + 0.3 × (1 - ρ̄<sub>i</sub>). Top 6: asset23, asset36, asset6, asset8, asset2, asset42. <strong>Resultado:</strong> Sharpe = 0.922, Rentabilidad = 11.02%, Volatilidad = 9.78%. <strong>Mejora +794.2% vs baseline.</strong></p>
                <div class="figure no-break">
                    <img src="notebooks_demostracion/outputs/modulo1_correlaciones.png" alt="Correlaciones">
                    <div class="figure-caption">Fig. 3: Heatmap de correlaciones entre activos seleccionados</div>
                </div>
            </div>

            <div class="layer-box no-break">
                <h3>Capa 5: Análisis Multipunto</h3>
                <p>Exploración N ∈ {3,4,5,6,7,8,9}. <strong>Óptimo: N = 4 activos + RF (10%)</strong> → Sharpe = 1.074, Rentabilidad = 12.47%, Volatilidad = 9.75%.</p>
                <div class="figure no-break">
                    <img src="notebooks_demostracion/outputs/comparacion_multipunto.png" alt="Multipunto">
                    <div class="figure-caption">Fig. 4: Comparación multipunto por estrategia</div>
                </div>
            </div>
        </div>

        <div class="section page-break">
            <h2>3. MÓDULOS EXPLORADOS (NO IMPLEMENTADOS)</h2>
            <ul class="compact-list">
                <li><strong>CAPM:</strong> Análisis preliminar de betas y alfas. No integrado por limitaciones de tiempo.</li>
                <li><strong>Memoria de precios:</strong> Análisis de autocorrelación completado, no implementado en pipeline final.</li>
                <li><strong>Factoriales:</strong> Exploración Fama-French y APT. No implementado por limitaciones de datos.</li>
            </ul>
        </div>

        <div class="section">
            <h2>4. RESULTADOS FINALES</h2>
            <div class="results-box no-break">
                <h3>Cartera Ganadora: 4 Activos + Renta Fija (10%)</h3>
                <p class="intro-text">Configuración óptima. Maximiza Sharpe con mejor balance riesgo-rendimiento.</p>
            </div>

            <table class="metrics-table no-break">
                <thead>
                    <tr>
                        <th>Estrategia</th>
                        <th>Sharpe</th>
                        <th>Rent. (%)</th>
                        <th>Vol. (%)</th>
                        <th>N Act.</th>
                        <th>Mejora</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Baseline (50A)</strong></td>
                        <td>0.103</td>
                        <td>3.25</td>
                        <td>12.06</td>
                        <td>50</td>
                        <td>-</td>
                    </tr>
                    <tr>
                        <td><strong>Markowitz 50A</strong></td>
                        <td>0.042</td>
                        <td>2.40</td>
                        <td>9.42</td>
                        <td>50</td>
                        <td>-59.2%</td>
                    </tr>
                    <tr>
                        <td><strong>Selección N=6</strong></td>
                        <td>0.922</td>
                        <td>11.02</td>
                        <td>9.78</td>
                        <td>6</td>
                        <td>+794.2%</td>
                    </tr>
                    <tr class="winner-highlight">
                        <td><strong>FINAL (N=4 + RF)</strong></td>
                        <td><strong>1.074</strong></td>
                        <td><strong>12.47</strong></td>
                        <td><strong>9.75</strong></td>
                        <td><strong>4</strong></td>
                        <td><strong>+942.7%</strong></td>
                    </tr>
                </tbody>
            </table>

            <div class="two-column no-break">
                <div>
                    <div class="highlight">
                        <p><strong>Restricciones:</strong></p>
                        <ul class="compact-list">
                            <li>✓ Long-only (w ≥ 0)</li>
                            <li>✓ Σw = 1.0</li>
                            <li>✓ RF = 10.0%</li>
                            <li>✓ Herfindahl = 0.42</li>
                        </ul>
                    </div>
                </div>
                <div>
                    <div class="highlight">
                        <p><strong>Composición:</strong></p>
                        <ul class="compact-list">
                            <li>4 activos: 90%</li>
                            <li>Renta fija: 10%</li>
                            <li>Sharpe prom: 1.12</li>
                            <li>Correl. prom: 0.58</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="figure no-break">
                <img src="notebooks_demostracion/outputs/heatmap_pesos_multipunto.png" alt="Pesos">
                <div class="figure-caption">Fig. 5: Distribución de pesos en carteras multipunto</div>
            </div>
        </div>

        <div class="section">
            <h2>5. CONCLUSIONES</h2>
            <p><strong>Validación empírica:</strong> Existe un N óptimo (4-6 activos) que maximiza el Sharpe. Más allá, beneficios marginales decrecientes.</p>
            <p><strong>Balance óptimo:</strong> Selección inteligente + Markowitz supera estrategias naive. <strong>Mejora +942.7%</strong> en Sharpe (0.103 → 1.074).</p>
            <p><strong>Framework modular:</strong> Arquitectura facilita integración futura de módulos avanzados sin modificar base existente.</p>
            <p><strong>Hallazgo clave:</strong> Cartera concentrada de 4 activos + RF supera tanto configuraciones más concentradas como más diversificadas, validando "diversificación inteligente" sobre "diversificación exhaustiva".</p>
        </div>

        <div class="footer">
            <p>Proyecto de Optimización de Carteras | 50 activos, 1760 días | Enfoque modular iterativo</p>
        </div>
    </div>
</body>
</html>
